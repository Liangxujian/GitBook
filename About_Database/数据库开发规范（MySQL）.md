# 数据库开发规范（MySQL）

## 一、设计规范

### 1.1 命名规范

1. 库名、表名、字段名必须使用小写字母，并采用下划线分割
2. 库名、表名、字段名禁止超过 32 字符（统一规范、提高辨识度、减少传输量）
3. 库名、表名、字段名禁止使用 MySQL 保留字，若字段名与关键字冲突，则需要在字段名的前后加上“`”

### 1.2 使用 INNODB 存储引擎

INNODB 引擎是 MySQL 5.5 版本以后的默认引擘，支持事务、行级锁，有更好的数据恢复能力、更好的并发性能，同时对多核、大内存、SSD 等硬件支持更好，支持数据热备份等，因此 INNODB 相比 MyISAM 有明显优势。

### 1.3 禁止使用分区表

分区表对分区键有严格要求；分区表在表变大后，执行 DDL、SHARDING、单表恢复等都变得更加困难。因此禁止使用分区表，并建议业务端手动 SHARDING。

### 1.4 建议使用 UNSIGNED 存储非负数值

同样的字节数，非负存储的数值范围更大。如 TINYINT 有符号为 -128-127，无符号为 0-255。

### 1.5 建议使用 INT UNSIGNED 存储 IPV4

### 1.6 强烈建议使用 TINYINT 来代替 ENUM 类型

ENUM 类型在需要修改或增加枚举值时，需要在线 DDL，成本较高；ENUM 列值如果含有数字类型，可能会引起默认值混淆。

### 1.7 使用 VARBINARY 存储大小写敏感的变长字符串或二进制内容

VARBINARY 默认区分大小写，没有字符集概念，速度快。

### 1.8 INT 类型固定占用4字节存储

### 1.9 区分使用 DATETIME 和 TIMESTAMP

存储年使用 YEAR 类型。存储日期使用 DATE 类型。 存储时间(精确到秒)建议使用 TIMESTAMP 类型。

DATETIME 和 TIMESTAMP 都是精确到秒，优先选择 TIMESTAMP，因为 TIMESTAMP 只有4个字节，而 DATETIME 8个字节。同时 TIMESTAMP 具有自动赋值以及自动更新的特性。注意：在 5.5 和之前的版本中，如果一个表中有多个TIMESTAMP 列，那么最多只能有一列能具有自动更新功能。

### 1.10 所有字段均定义为 NOT NULL

a) 对表的每一行，每个为 NULL 的列都需要额外的空间来标识。 
b) B 树索引时不会存储 NULL 值，所以如果索引字段可以为 NULL，索引效率会下降。 
c) 建议用 0、特殊值或空串代替 NULL 值。

## 二、MySQL 使用技巧

1. 将大字段、访问效率低的字段拆分到单独的表中存储，分离冷热数据

2. 禁止在数据库中存储明文密码

3. 表必须有主键，推荐使用 UNSIGNED 自增列作为主键

4. 禁止冗余索引

5. 禁止重复索引

6. 不在低基数列上建立索引，例如：“性别”

7. 合理使用覆盖索引减少 IO，避免排序

   （能够建立索引的种类分为：主键索引、唯一索引、普通索引三种，而覆盖索引只是一种查询的一种效果，即一个查询语句的执行只用从索引中就能够取得，不必从数据表中读取。用 explain 的结果，extra 列会出现：using index）

8. 用 IN 代替 OR。SQL 语句中 IN 包含的值不应过多，应少于1000个

9. 表字符集使用 UTF8，必要时可申请使用 UTF8MB4 字符集

10. 用 UNION ALL 代替 UNION

11. 禁止使用 order by rand()

12. 建议使用合理的分页方式以提高分页效率

13. SELECT 只获取必要的字段，禁止使用 SELECT *

14. SQL 中避免出现 now()、rand()、sysdate()、current_user() 等不确定结果的函数

15. 采用合适的分库分表策略。例如千库十表、十库百表等

16. 减少与数据库交互的次数，尽量采用批量 SQL 语句

17. 拆分复杂 SQL 为多个小 SQL，避免大事务

18. 对同一个表的多次 alter 操作必须合并为一次操作

19. 避免使用存储过程、触发器、视图、自定义函数等

20. 禁止有 super 权限的应用程序账号存在

21. 不要在 MySQL 数据库中存放业务逻辑